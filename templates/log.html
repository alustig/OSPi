$def with (records)

$code:
	snames = eval(data('snames'))
	if gv.sd['lg'] == 1:
		log_state = "Enabled"
		log_option = "checked"
	else:
		log_state = "Disabled"
		log_option = ""
		
	def formatTime(t):
		if gv.sd['tf']:
			return t
		else:
			hour = int(t[0:2])
			newhour = hour
			if hour == 0:
				newhour = 12
			if hour > 12:
				newhour = hour-12
			return str(newhour)  + t[2:] + (" am" if hour<12 else " pm")
			
$code:
	days= json.dumps([_('Sunday'), _('Monday'), _('Tuesday'), _('Wednesday'), _('Thursday'), _('Friday'), _('Saturday')])
	months = json.dumps([_('January'), _('February'), _('March'), _('April'), _('May'), _('June'), _('July'), _('August'), _('September'), _('October'), _('November'), _('December')])
			

<!doctype html>

<html>

<html>
<head>
	<meta name="viewport" content="width=640">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>$_('OpenSprinkler Pi Log') ${" - "+gv.sd['name'] if gv.sd['name']!="OpenSprinkler Pi" else ""}</title>
	<link href="/static/images/favicon.ico" rel="icon" type="image/x-icon">
	<link href="${gv.baseurl}/static/themes/${gv.sd['theme']}/base.css" rel="stylesheet" type="text/css"/>	
	<style>
		h2 {
			text-align: center;
			font-family: Sans-serif;
		}
	</style>
	<script src="${gv.baseurl}/static/scripts/jquery-1.8.2.min.js"></script>
	<script>
		// Variables set by ospi.py
		var devt = ${gv.now}*1000;
		var tz = ${gv.sd['tz']};
		var timeFormat = ${gv.sd['tf']};
		var cputemp = "${gv.cputemp}";
		var tempunit = "${gv.sd['tu']}";
	</script>
	<script src="${gv.baseurl}/static/scripts/behaviors.js"></script>
	<script>
		// date/time formating helpers
		var dayList = $:{days};
    	var monthList = $:{months};
	</script>	
	<script>
		// Initialize behaviors
		jQuery(document).ready(function(){
			jQuery("button#nRefresh").click(function(){
				window.location="/vl";
			});
			jQuery("button#nDeleteAll").click(function(){
				jQuery("form#df").submit();
			});
		});

	</script>
</head>
	
<body>
	<div class="content">
		<div class="header">
			<div class="title">${gv.sd['name'] if gv.sd['name']!="OpenSprinkler Pi" else ""}</div>
		</div>
			
		<div class="body">
		
			<div id="status">
				<p id="deviceTime"><span class="hour"></span><span class="sep">:</span><span class="minute"></span><span class="second"></span><span class="ampm"></span></p>
				<p id="deviceDate"></p>
			</div>
	
			<div class="panel">
			
				<div id="nav">
					<button id="bHome" class="home" title=$:{json.dumps(_('Home'), ensure_ascii=False)}>$_('Home')</button>
					<button id="bPrograms" class="programs" title=$:{json.dumps(_('Define Programs'), ensure_ascii=False)}>$_('Programs')</button>
					<button id="bRunOnce" class="start" title=$:{json.dumps(_('Define Run Once Program'), ensure_ascii=False)}>$_('Run Once')</button>
					<button id="bLog" class="log here" title=$:{json.dumps(_('View Log'), ensure_ascii=False)}>$_('Log')</button>
					<button id="bOptions" class="options" title=$:{json.dumps(_('Options'), ensure_ascii=False)}>$_('Options')</button>
					<button id="bStations" class="stations" title=$:{json.dumps(_('Configure Stations'), ensure_ascii=False)}>$_('Stations')</button>
					$if not(gv.sd['ipas']):
						<button id="bLogout" class="logout" title=$:{json.dumps(_('Logout'), ensure_ascii=False)}>$_('Logout')</button>
				</div>
				
				<div id="options">
					<div class="title">$_('Log') $log_state</div>
					<form method="get" action="cl" name="df" id="df"></form>
				</div>
				
				<div id="log">
					<p>$_('Total number of records'): ${len(records)} (${_("no") if gv.sd['lr']==0 else gv.sd['lr']} $_('limit'))</p>
					<p>$_('Download log as') <a href="/wl">csv</a>.</p>
					
					<table class="logList">
						<tr class="log_rec">
							<th>$_('Date')</th>
							<th>$_('Start Time')</th>
							<th>$_('Station')</th>
							<th>$_('Duration')</th>
							<th>$_('Program')</th>
						</tr>
						$ odd = 1
						$for r in records:
							$ event = json.loads(r)
							<tr class="log_rec ${'odd' if odd else 'even'}">
								<td align='center'>${event["date"]}</td>
								<td align='center'>${formatTime(event["start"])}</td>
								<td align='center'>${snames[event["station"]]}</td>
								<td align='center'>${event["duration"]}</td>
								<td align='center'>${event["program"]}</td>
							</tr>
							$ odd = 1 - odd
					</table>
	
				</div>
				
				<div id="controls">
					<button id="nRefresh" class="refresh">$_('Refresh')</button>
					<button id="nDeleteAll" class="delete danger">$_('Clear Log')</button>
				</div>
				
			</div>
		</div>
		
		<div class="footer">
			<p>$_('CPU Temp'): <b><span id="heat" style="cursor:pointer" title="Click to toggle Celsius &lt;&gt; Fahrenheit"></span></b></p>
			<p><a href="https://github.com/Dan-in-CA/OSPi">$_('Software')</a> $_('version'): <b>${".".join(list(str(gv.ver)))}</b></p>
		</div>
	</div>
</body>

</html>